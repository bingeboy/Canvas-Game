for(var c=!0,d=!1,f=0,h=["ms","moz","webkit","o"],i=0;i<h.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[h[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[h[i]+"CancelAnimationFrame"]||window[h[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),e=Math.max(0,16-(b-f)),k=window.setTimeout(function(){a(b+e)},e);f=b+e;return k});
window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});function j(a){var b={color:"#fff",align:"center",size:15,x:l>>1,y:m>>1},e;for(e in b)a[e]=a[e]?a[e]:b[e];"undefined"===typeof a.text||0===a.text.length||(p&&(q.shadowColor="rgba(0,0,0,0)"),q.font=a.size+"px arial",b=q.measureText(a.text).width,q.fillStyle="rgba(0,0,0,0.7)",q.fillRect(a.x-(b>>1)-10,a.y-8,b+17,a.size+18),q.textAlign=a.align,q.textBaseline="top",q.fillStyle=a.color,q.fillText(a.text,a.x,a.y))}
function s(){var a=l>>1,b=~~(0.48*m),e=~~(0.75*m);p&&(q.shadowColor="rgba(0,0,0,0)");q.textBaseline="alphabetic";q.fillStyle="rgba(0,0,0,0.7)";q.fillRect(a-255,b-88,510,106);q.font="98px arial";q.fillStyle="#538";q.textAlign="center";q.fillText("SQUARE'D",a,b);q.font="100px arial";q.lineWidth=1;q.strokeStyle="#a7f";q.textAlign="center";q.strokeText("SQUARE'D",a,b);j({text:"Press space to start",y:e-18});j({text:"Controls: Arrow keys or W, A, S, D to move; Mouse to aim and fire",y:e+18});gameClock=
Date.now()}
function t(){gameClock=Date.now();u=0;v=1.3;w={x:~~(l/2),y:~~(m/2),d:100,o:d,l:d,m:d,n:d,s:d,c:25,f:[],z:function(){this.f.push({x:this.x,y:this.y,a:Math.atan2(x.x-this.x,x.y-this.y)})},t:function(){this.m&&(0<this.x&&!this.n)&&(this.x-=0.12*y);w.n&&(this.x<z.width&&!this.m)&&(this.x+=0.12*y);this.o&&(0<this.y&&!this.l)&&(this.y-=0.12*y);this.l&&(this.y<z.height&&!this.o)&&(this.y+=0.12*y);if(this.s&&0>=(this.c-=0.2*y))this.z(),this.c=25;var a,b,e,k;for(k in this.f){a=this.f[k];cacheIndex=~~(100*
a.a);a.x+=A[cacheIndex]*0.7*y;a.y+=B[cacheIndex]*0.7*y;for(e in C.b)if(b=C.b[e],void 0!==a&&a.x<b.x+b.size&&a.x>b.x-b.size&&a.y<b.y+b.size&&a.y>b.y-b.size&&"dead"!==b.status){b.d--;0<b.d?(b.status="wounded",b.x+=6*A[cacheIndex],b.y+=6*B[cacheIndex]):(b.status="dead",b.a=a.a,b.c=100,u++,b.k={x:a.x,y:a.y});this.f.splice(k,1);break}void 0!==a&&(0>a.x||a.x>z.width||0>a.y||a.y>z.height)&&this.f.splice(k,1)}},h:function(){var a;p&&(q.shadowColor="rgba(0,0,0,1)",q.shadowBlur=15,q.shadowOffsetX=0,q.shadowOffsetY=
0);q.fillStyle="#0f0";q.fillRect(w.x-4,w.y-4,8,8);p&&(q.shadowColor="rgba(255,255,0,1)");q.strokeStyle="rgba(255, 255, 255, 1)";q.lineWidth=4;q.beginPath();for(var b in this.f)a=~~(100*Math.atan2(w.x-~~this.f[b].x,w.y-~~this.f[b].y)),q.moveTo(~~this.f[b].x,~~this.f[b].y),q.lineTo(~~this.f[b].x+18*A[a],~~this.f[b].y+18*B[a]);q.stroke();q.closePath()}};C={b:{},w:{wanderChase:function(a){var a=C.b[a],b=Math.atan2(w.x-a.x,w.y-a.y);0>a.c&&(a.a=b,a.c=~~(3900*Math.random())+2300);b=~~(100*a.a);a.x+=A[b]*
a.speed*y;a.y+=B[b]*a.speed*y;a.c-=y},chase:function(a){a=C.b[a];a.a=Math.atan2(w.x-a.x,w.y-a.y);var b=~~(100*a.a);a.x+=A[b]*a.speed*y;a.y+=B[b]*a.speed*y},divebomb:function(a){var b=~~(100*C.b[a].a),a=C.b[a];a.x+=A[b]*a.speed*y;a.y+=B[b]*a.speed*y;if(0>a.x||a.x>z.width||0>a.y||a.y>z.height)a.d=0,a.c=0},centipede:function(a){var b=C.b[a];0<b.c&&(b.c-=y,0>=b.c&&b.p&&(C.A({x:b.u,y:b.v,u:b.u,v:b.v,size:b.size,a:b.a,i:6E3,q:0.04*Math.random()-0.02,j:a,c:500,e:"centipede",color:b.color,d:1,status:"alive",
speed:b.speed,p:b.p-1}),b.p=0));if(""===b.j||"dead"===C.b[b.j].status)""!==b.j&&(b.j="",b.d++),b.color="rgba(220,0,220",0<b.i&&(b.i-=y,0>=b.i&&(b.i=6E3,b.q=0.04*Math.random()-0.02)),b.a+=b.q,C.w.wander(a);else{b.color="rgba(140,0.140";var a=C.b[b.j],e=b.x-a.x,k=b.y-a.y;b.speed=20<Math.sqrt(e*e+k*k)?0.092:0.05;b.a=Math.atan2(a.x-b.x,a.y-b.y);a=~~(100*b.a);b.x+=A[a]*b.speed*y;b.y+=B[a]*b.speed*y}},wander:function(a){a=C.b[a];a.a>D&&(a.a-=E);a.a<-D&&(a.a+=E);0>a.x?0>a.a&&(a.a=-a.a):a.x>z.width&&0<a.a&&
(a.a=-a.a);0>a.y?(a.a<-F&&(a.a=-F+(-F-a.a)),a.a>F&&(a.a=F+(F-a.a))):a.y>z.height&&(0>a.a&&a.a>-F&&(a.a=-F+(-F-a.a)),0<a.a&&a.a<F&&(a.a=F+(F-a.a)));var b=~~(100*a.a);a.x+=A[b]*a.speed*y;a.y+=B[b]*a.speed*y}},types:[{size:46,speed:0.042,d:1,color:"rgba(255,0,0",e:"wander",c:0,g:1},{size:22,speed:0.092,d:1,color:"rgba(255,100,0",e:"wander",c:0,g:1},{size:52,speed:0.022,d:3,color:"rgba(255,0,120",e:"chase",c:0,g:1},{size:35,speed:0.092,d:2,color:"rgba(220,0,220",e:"centipede",c:500,g:0.13},{size:28,speed:0.099,
d:2,color:"rgba(255,255,0",e:"wanderChase",c:3900,g:1},{size:20,speed:0.064,d:1,color:"rgba(0,255,255",e:"chase",c:0,g:1},{size:30,speed:0.17,d:1,color:"rgba(255,140,100",e:"divebomb",c:0,g:1},{size:42,speed:0.032,d:5,color:"rgba(255,155,255",e:"wander",c:0,g:1}],A:function(a){G++;var b="e"+G;this.b[b]=a;return b},t:function(){if(v>100*Math.random()){var a,b=~~(4*Math.random());a=~~(Math.random()*Math.min(~~v,this.types.length-1));a=this.types[a];if(1===a.g||Math.random()<a.g){a={size:a.size,speed:a.speed,
d:a.d,color:a.color,e:a.e,c:a.c,status:"alive"};switch(b){case 0:a.x=~~(Math.random()*z.width);a.y=0;break;case 1:a.x=~~(Math.random()*z.width);a.y=z.height;break;case 2:a.x=0;a.y=~~(Math.random()*z.height);break;case 3:a.x=z.width,a.y=~~(Math.random()*z.height)}a.a=Math.atan2(w.x-a.x,w.y-a.y);switch(a.e){case "centipede":a.j="",a.p=~~(10*Math.random())+8,a.u=a.x,a.v=a.y,a.q=0.04*Math.random()-0.02,a.i=6E3;default:this.A(a)}}}for(var e in C.b)b=this.b[e],void 0!==b&&"dead"!==b.status&&(this.w[b.e](e),
b.x<w.x+(b.size>>1)&&(b.x>w.x-(b.size>>1)&&b.y<w.y+(b.size>>1)&&b.y>w.y-(b.size>>1))&&(clearInterval(H),I=d))},h:function(){var a=1,b,e,k,n,r;p&&(q.shadowBlur=5,q.shadowOffsetX=3,q.shadowOffsetY=3);for(var g in this.b)if(void 0!==this.b[g])if(r=this.b[g].size,"dead"!==this.b[g].status)p&&(q.shadowColor="rgba(0,0,0,1)"),"wounded"!==this.b[g].status?n=this.b[g].color+",1)":(this.b[g].status="alive",n="rgba(255,255,255,1)"),q.fillStyle!==n&&(q.fillStyle=n),q.fillRect(~~this.b[g].x-(r>>1),~~this.b[g].y-
(r>>1),r,r);else if(this.b[g].c-=0.1*y,n=this.b[g].c,0>=n)delete this.b[g];else{p&&(q.shadowColor="rgba(0,0,0,0)");if(84<n){a=3;q.strokeStyle="rgba(255, 255, 0, 1)";q.lineWidth=4;q.beginPath();e=Math.random()*(110-n);for(k=Math.random()*(140-n);--a;)b=~~(628*Math.random()-314),q.moveTo(~~(this.b[g].k.x+A[b]*e),~~(this.b[g].k.y+B[b]*e)),q.lineTo(~~(this.b[g].k.x+A[b]*k),~~(this.b[g].k.y+B[b]*k));q.stroke();q.closePath()}cacheIndex=~~(100*this.b[g].a);this.b[g].x+=A[cacheIndex]*0.03*n;this.b[g].y+=
B[cacheIndex]*0.03*n;a=(n/100).toFixed(2);q.fillStyle=this.b[g].color+","+a+")";r+=~~(r*((100-n)/100));q.fillRect(~~this.b[g].x-(r>>1),~~this.b[g].y-(r>>1),r,r)}}}}function J(){if(!I||K)return d;var a=Date.now();y=a-gameClock;v+=2E-5*y;L++;M+=y;gameClock=a;w.t();C.t();z.h();C.h();w.h();x.h();j({color:"#f0f",text:"Score: "+u,x:80,y:30});a=~~(L/(M/1E3));j({color:"#f0f",text:"FPS: "+a,x:80,y:55});p&&(50>a&&1E4<M)&&(q.shadowColor="rgba(0,0,0,0)",p=d);I||s();requestAnimationFrame(J)}
var N,q,w={},z={},C={},v=0.7,u=0,H,I=d,K=d,D=Math.PI,F=Math.PI/2,E=2*Math.PI,l,m,B,A,O=200*E>>0,x={},y=0,L=0,M=0,p=c,G=0;gameClock=Date.now();A=[];for(var P=-O;P<O;P++)A[P]=Math.sin(P/100);B=[];for(P=-O;P<O;P++)B[P]=Math.cos(P/100);l=900;m=660;N=document.getElementById("gamecanvas");q=N.getContext("2d");bgcanvas=document.getElementById("bgcanvas");bgctx=bgcanvas.getContext("2d");N.setAttribute("width",l);N.setAttribute("height",m);bgcanvas.setAttribute("width",l);bgcanvas.setAttribute("height",m);
function Q(){var a=document.getElementById("bgimg");z.r={B:a,width:a.width,height:a.height};bgctx.drawImage(z.r.B,0,0,z.r.width,z.r.height,0,0,l,m)}document.getElementById("bgimg").onload=Q;document.getElementById("bgimg").complete&&Q();z={width:l,height:m,offset:{left:window.innerWidth/2-N.width/2,top:N.offsetTop},C:"gravel.png",h:function(){p&&(q.shadowColor="rgba(0,0,0,0)");N.width=N.width}};
x={x:0,y:0,h:function(){p&&(q.shadowColor="rgba(0,0,0,0)");q.strokeStyle="#0ff";q.strokeRect(x.x-4,x.y-4,8,8)}};p&&(q.shadowColor="rgba(0,0,0,0)");q.fillStyle="#000";q.fillRect(0,0,l,m);document.onmousemove=function(a){x.x=(a.pageX-z.offset.left)/1;x.y=(a.pageY-z.offset.top)/1};document.onmousedown=function(a){w.z();w.s=c;w.c=20;a.stopPropagation();return d};document.onmouseup=function(){w.s=d};
window.onkeydown=function(a){switch(a.keyCode){case 38:case 87:w.o=c;break;case 37:case 65:w.m=c;break;case 39:case 68:w.n=c;break;case 40:case 83:w.l=c;break;case 32:I?K?(gameClock=Date.now(),K=d,requestAnimationFrame(J)):(j({text:"PAUSED",size:60,color:"#538"}),j({text:"Press space to unpause.",y:(m>>1)+100}),K=c,M=L=0):(I=c,t(),requestAnimationFrame(J))}};
window.onkeyup=function(a){switch(a.keyCode){case 38:case 87:w.o=d;break;case 37:case 65:w.m=d;break;case 39:case 68:w.n=d;break;case 40:case 83:w.l=d}};s();t();
