for(var c=!0,d=!1,g=0,h=["ms","moz","webkit","o"],i=0;i<h.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[h[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[h[i]+"CancelAnimationFrame"]||window[h[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),f=Math.max(0,16-(b-g)),s=window.setTimeout(function(){a(b+f)},f);g=b+f;return s});
window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});function j(a){var b={color:"#fff",align:"center",size:15,x:k>>1,y:m>>1},f;for(f in b)a[f]=a[f]?a[f]:b[f];"undefined"===typeof a.text||0===a.text.length||(n&&(p.shadowColor="rgba(0,0,0,0)"),p.font=a.size+"px arial",b=p.measureText(a.text).width,p.fillStyle="rgba(0,0,0,0.7)",p.fillRect(a.x-(b>>1)-10,a.y-8,b+17,a.size+18),p.textAlign=a.align,p.textBaseline="top",p.fillStyle=a.color,p.fillText(a.text,a.x,a.y))}
function q(){var a=k>>1,b=~~(0.48*m),f=~~(0.75*m);n&&(p.shadowColor="rgba(0,0,0,0)");p.textBaseline="alphabetic";p.fillStyle="rgba(0,0,0,0.7)";p.fillRect(a-255,b-88,510,106);p.font="98px arial";p.fillStyle="#538";p.textAlign="center";p.fillText("SQUARE'D",a,b);p.font="100px arial";p.lineWidth=1;p.strokeStyle="#a7f";p.textAlign="center";p.strokeText("SQUARE'D",a,b);j({text:"Press space to start",y:f-18});j({text:"Controls: W, A, S, D to move; Mouse to aim and fire",y:f+18});t=Date.now()}
function u(){t=Date.now();v=0;w=1.3;x={x:~~(k/2),y:~~(m/2),c:100,l:d,i:d,j:d,k:d,n:d,d:25,e:[],p:function(){this.e.push({x:this.x,y:this.y,a:Math.atan2(y.x-this.x,y.y-this.y)})},o:function(){this.j&&(0<this.x&&!this.k)&&(this.x-=0.12*z);x.k&&(this.x<A.width&&!this.j)&&(this.x+=0.12*z);this.l&&(0<this.y&&!this.i)&&(this.y-=0.12*z);this.i&&(this.y<A.height&&!this.l)&&(this.y+=0.12*z);if(this.n&&0>=(this.d-=0.2*z))this.p(),this.d=25;var a,b,f,s;for(s in this.e){a=this.e[s];cacheIndex=~~(100*a.a);a.x+=
B[cacheIndex]*0.7*z;a.y+=C[cacheIndex]*0.7*z;for(f in D.b)if(b=D.b[f],void 0!==a&&a.x<b.x+b.size&&a.x>b.x-b.size&&a.y<b.y+b.size&&a.y>b.y-b.size&&0<b.c){b.c--;0>=b.c&&(b.a=a.a,b.d=100,v++,b.h={x:a.x,y:a.y});this.e.splice(s,1);break}void 0!==a&&(0>a.x||a.x>A.width||0>a.y||a.y>A.height)&&this.e.splice(s,1)}},g:function(){var a;n&&(p.shadowColor="rgba(0,0,0,1)");n&&(p.shadowBlur=15);n&&(p.shadowOffsetX=0);n&&(p.shadowOffsetY=0);p.fillStyle="#0f0";p.fillRect(x.x-4,x.y-4,8,8);n&&(p.shadowColor="rgba(255,255,0,1)");
p.strokeStyle="rgba(255, 255, 255, 1)";p.lineWidth=4;p.beginPath();for(var b in this.e)a=~~(100*Math.atan2(x.x-~~this.e[b].x,x.y-~~this.e[b].y)),p.moveTo(~~this.e[b].x,~~this.e[b].y),p.lineTo(~~this.e[b].x+18*B[a],~~this.e[b].y+18*C[a]);p.stroke();p.closePath()}};D={b:[],q:{wanderChase:function(a){var a=D.b[a],b=Math.atan2(x.x-a.x,x.y-a.y);0>a.d&&(a.a=b,a.d=~~(900*Math.random())+300);b=~~(100*a.a);a.x+=B[b]*a.speed*z;a.y+=C[b]*a.speed*z;a.d-=z},chase:function(a){a=D.b[a];a.a=Math.atan2(x.x-a.x,x.y-
a.y);var b=~~(100*a.a);a.x+=B[b]*a.speed*z;a.y+=C[b]*a.speed*z},divebomb:function(a){var b=~~(100*D.b[a].a),a=D.b[a];a.x+=B[b]*a.speed*z;a.y+=C[b]*a.speed*z;if(0>a.x||a.x>A.width||0>a.y||a.y>A.height)a.c=0,a.d=0},wander:function(a){a=D.b[a];a.a>E&&(a.a-=F);a.a<-E&&(a.a+=F);0>a.x?0>a.a&&(a.a=-a.a):a.x>A.width&&0<a.a&&(a.a=-a.a);0>a.y?(a.a<-G&&(a.a=-G+(-G-a.a)),a.a>G&&(a.a=G+(G-a.a))):a.y>A.height&&(0>a.a&&a.a>-G&&(a.a=-G+(-G-a.a)),0<a.a&&a.a<G&&(a.a=G+(G-a.a)));var b=~~(100*a.a);a.x+=B[b]*a.speed*
z;a.y+=C[b]*a.speed*z}},types:[{size:46,speed:0.042,c:1,color:"rgba(255,0,0",f:"wander"},{size:22,speed:0.092,c:1,color:"rgba(255,100,0",f:"wander"},{size:52,speed:0.022,c:3,color:"rgba(255,0,120",f:"chase"},{size:28,speed:0.099,c:2,color:"rgba(255,255,0",f:"wanderChase",d:3900},{size:20,speed:0.064,c:1,color:"rgba(0,255,255",f:"chase"},{size:30,speed:0.17,c:1,color:"rgba(255,140,100",f:"divebomb"},{size:42,speed:0.032,c:5,color:"rgba(255,155,255",f:"wander"}],s:function(a){this.b.push(a)},o:function(){if(w>
100*Math.random()){var a,b=~~(4*Math.random());a=~~(Math.random()*~~w);a>this.types.length-1&&(a=this.types.length-1);a=this.types[a];a={size:a.size,speed:a.speed,c:a.c,color:a.color,f:a.f};switch(b){case 0:a.x=~~(Math.random()*A.width);a.y=0;break;case 1:a.x=~~(Math.random()*A.width);a.y=A.height;break;case 2:a.x=0;a.y=~~(Math.random()*A.height);break;case 3:a.x=A.width,a.y=~~(Math.random()*A.height)}a.a=Math.atan2(x.x-a.x,x.y-a.y);this.s(a)}for(var f in D.b)b=this.b[f],void 0!==b&&b.c&&(this.q[b.f](f),
b.x<x.x+(b.size>>1)&&(b.x>x.x-(b.size>>1)&&b.y<x.y+(b.size>>1)&&b.y>x.y-(b.size>>1))&&(clearInterval(H),I=d))},g:function(){var a=1,b,f,s,r,l;n&&(p.shadowBlur=5);n&&(p.shadowOffsetX=3);n&&(p.shadowOffsetY=3);for(var e in this.b)if(void 0!==this.b[e])if(l=this.b[e].size,this.b[e].c)n&&(p.shadowColor="rgba(0,0,0,1)"),r=this.b[e].color+",1)",p.fillStyle!==r&&(p.fillStyle=this.b[e].color+",1)"),p.fillRect(~~this.b[e].x-(l>>1),~~this.b[e].y-(l>>1),l,l);else if(this.b[e].d-=0.1*z,r=this.b[e].d,0>=r)this.b.splice(e,
1);else{n&&(p.shadowColor="rgba(0,0,0,0)");if(84<r){a=3;p.strokeStyle="rgba(255, 255, 0, 1)";p.lineWidth=4;p.beginPath();f=Math.random()*(110-r);for(s=Math.random()*(140-r);--a;)b=~~(628*Math.random()-314),p.moveTo(~~(this.b[e].h.x+B[b]*f),~~(this.b[e].h.y+C[b]*f)),p.lineTo(~~(this.b[e].h.x+B[b]*s),~~(this.b[e].h.y+C[b]*s));p.stroke();p.closePath()}cacheIndex=~~(100*this.b[e].a);this.b[e].x+=B[cacheIndex]*0.03*r;this.b[e].y+=C[cacheIndex]*0.03*r;a=(r/100).toFixed(2);p.fillStyle=this.b[e].color+","+
a+")";l+=~~(l*((100-r)/100));p.fillRect(~~this.b[e].x-(l>>1),~~this.b[e].y-(l>>1),l,l)}}}}function J(){if(!I||K)return d;var a=Date.now();z=a-t;w+=2E-5*z;L++;M+=z;t=a;x.o();D.o();A.g();D.g();x.g();y.g();j({color:"#f0f",text:"Score: "+v,x:80,y:30});a=~~(L/(M/1E3));j({color:"#f0f",text:"FPS: "+a,x:80,y:55});n&&(50>a&&1E4<M)&&(p.shadowColor="rgba(0,0,0,0)",n=d);I||q();requestAnimationFrame(J)}
var N,p,x={},A={},D={},w=0.7,v=0,H,I=d,K=d,E=Math.PI,G=Math.PI/2,F=2*Math.PI,k,m,C,B,O=200*F>>0,y={},z=0,L=0,M=0,n=c,t=Date.now();B=[];for(var P=-O;P<O;P++)B[P]=Math.sin(P/100);C=[];for(P=-O;P<O;P++)C[P]=Math.cos(P/100);k=900;m=660;N=document.getElementById("gamecanvas");p=N.getContext("2d");bgcanvas=document.getElementById("bgcanvas");bgctx=bgcanvas.getContext("2d");N.setAttribute("width",k);N.setAttribute("height",m);bgcanvas.setAttribute("width",k);bgcanvas.setAttribute("height",m);
function Q(){var a=document.getElementById("bgimg");A.m={r:a,width:a.width,height:a.height};bgctx.drawImage(A.m.r,0,0,A.m.width,A.m.height,0,0,k,m)}document.getElementById("bgimg").onload=Q;document.getElementById("bgimg").complete&&Q();A={width:k,height:m,offset:{left:window.innerWidth/2-N.width/2,top:N.offsetTop},t:"gravel.png",g:function(){n&&(p.shadowColor="rgba(0,0,0,0)");N.width=N.width}};
y={x:0,y:0,g:function(){n&&(p.shadowColor="rgba(0,0,0,0)");p.strokeStyle="#0ff";p.strokeRect(y.x-4,y.y-4,8,8)}};n&&(p.shadowColor="rgba(0,0,0,0)");p.fillStyle="#000";p.fillRect(0,0,k,m);document.onmousemove=function(a){y.x=(a.pageX-A.offset.left)/1;y.y=(a.pageY-A.offset.top)/1};document.onmousedown=function(a){x.p();x.n=c;x.d=20;a.stopPropagation();return d};document.onmouseup=function(){x.n=d};
window.onkeydown=function(a){console.log(a.keyCode);switch(a.keyCode){case 38:case 87:x.l=c;break;case 37:case 65:x.j=c;break;case 39:case 68:x.k=c;break;case 40:case 83:x.i=c;break;case 32:I?K?(t=Date.now(),K=d,requestAnimationFrame(J)):(j({text:"PAUSED",size:60,color:"#538"}),j({text:"Press space to unpause.",y:(m>>1)+100}),K=c,M=L=0):(I=c,u(),requestAnimationFrame(J))}};
window.onkeyup=function(a){switch(a.keyCode){case 38:case 87:x.l=d;break;case 37:case 65:x.j=d;break;case 39:case 68:x.k=d;break;case 40:case 83:x.i=d}};q();u();
