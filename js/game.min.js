for(var h=!0,j=null,k=!1,m=0,n=["ms","moz","webkit","o"],q=0;q<n.length&&!window.requestAnimationFrame;++q)window.requestAnimationFrame=window[n[q]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[q]+"CancelAnimationFrame"]||window[n[q]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),c=Math.max(0,16-(b-m)),e=window.setTimeout(function(){a(b+c)},c);m=b+c;return e});
window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});window.qa=window.qa||{};window.ja=window.ja||{push:function(){return k}};g={q:h,ba:1,w:900,t:600,aa:0,G:0,canvas:document.getElementById("gamecanvas"),W:document.getElementById("bgcanvas")};g.d=g.canvas.getContext("2d");g.ka=g.W.getContext("2d");g.canvas.setAttribute("width",g.w);g.canvas.setAttribute("height",g.t);g.W.setAttribute("width",g.w);g.W.setAttribute("height",g.t);window.onload=function(){g.a.ga();g.a.ia()};g.c={U:Math.PI,p:Math.PI/2,ya:Math.PI/4,K:2*Math.PI,m:j,n:j,M:400*Math.PI>>0,oa:function(a,b,c,e){a-=c;b-=e;return Math.sqrt(a*a+b*b)},pa:function(a){return{left:window.innerWidth/2-a.width/2,top:a.offsetTop}}};g.a={V:0,I:k,paused:k,frame:0.7,h:0,H:Date.now(),J:[],ga:function(){g.q&&(g.d.shadowColor="rgba(0,0,0,0)");g.Y="survival";g.c.n=[];for(var a=-g.c.M;a<g.c.M;a++)g.c.n[a]=Math.sin(a/100);g.c.m=[];for(a=-g.c.M;a<g.c.M;a++)g.c.m[a]=Math.cos(a/100);g.k.va();g.a.H=Date.now();g.a.ma()},na:function(){_gaq.push(["_trackEvent","Game",g.Y,"Score",g.a.V]);g.a.ga()},ia:function(){g.a.H=Date.now();g.a.V=0;g.a.frame=1.9;g.a.field.la();if(g.a.J.length)for(var a=0,b=g.a.J.length;a<b;a++)g.a.J[a]()},ra:function(){g.C[g.Y]();
g.a.b.N();g.a.f.N()},ta:function(){g.a.field.z();g.a.f.z();g.a.b.z();g.k.v.z();g.k.wa();g.a.I||g.a.na()},Z:function(){if(!g.a.I||g.a.paused)return k;var a=Date.now();g.a.h=a-g.a.H;g.a.frame+=2E-5*g.a.h;g.aa++;g.G+=g.a.h;g.a.H=a;g.a.ra();g.a.ta();requestAnimationFrame(g.a.Z)},ma:function(){document.onmousemove=function(a){g.k.v.x=(a.pageX-g.a.field.offset.left)/g.ba;g.k.v.y=(a.pageY-g.a.field.offset.top)/g.ba};document.onmousedown=function(a){g.a.b.da();g.a.b.$=h;g.a.b.g=20;a.stopPropagation();return k};
document.onmouseup=function(){g.a.b.$=k};window.onkeydown=function(a){switch(a.keyCode){case 38:case 87:g.a.b.R=h;break;case 37:case 65:g.a.b.P=h;break;case 39:case 68:g.a.b.Q=h;break;case 40:case 83:g.a.b.O=h;break;case 32:g.a.I?g.a.paused?(g.a.H=Date.now(),g.a.paused=k,requestAnimationFrame(g.a.Z)):(g.k.ua(),g.a.paused=h,g.aa=0,g.G=0):(g.a.I=h,g.a.N=g.C[g.Y],g.a.ia(),requestAnimationFrame(g.a.Z))}};window.onkeyup=function(a){switch(a.keyCode){case 38:case 87:g.a.b.R=k;break;case 37:case 65:g.a.b.P=
k;break;case 39:case 68:g.a.b.Q=k;break;case 40:case 83:g.a.b.O=k}}}};g.a.field={width:g.w,height:g.t,offset:g.c.pa(g.canvas),xa:"gravel.png",z:function(){g.q&&(g.d.shadowColor="rgba(0,0,0,0)");g.canvas.width=g.canvas.width},la:function(){var a=document.getElementById("bgimg");g.a.field.X={sa:a,width:a.width,height:a.height};g.ka.drawImage(g.a.field.X.sa,0,0,g.a.field.X.width,g.a.field.X.height,0,0,g.w,g.t)}};g.k={B:function(a){var b={color:"#fff",align:"center",size:15,x:g.w>>1,y:g.t>>1},c;for(c in b)a[c]=a[c]?a[c]:b[c];if(void 0===a.text||!a.text.length)return k;g.q&&(g.d.shadowColor="rgba(0,0,0,0)");g.d.font=a.size+"px arial";b=g.d.measureText(a.text).width;g.d.fillStyle="rgba(0,0,0,0.7)";g.d.fillRect(a.x-(b>>1)-10,a.y-8,b+17,a.size+18);g.d.textAlign=a.align;g.d.textBaseline="top";g.d.fillStyle=a.color;g.d.fillText(a.text,a.x,a.y)},wa:function(){g.k.B({color:"#f0f",text:"Score: "+g.a.V,x:80,y:30});
var a=~~(g.aa/(g.G/1E3));g.k.B({color:"#f0f",text:"FPS: "+a,x:80,y:55});g.q&&(50>a&&1E4<g.G)&&(g.d.shadowColor="rgba(0,0,0,0)",g.q=k)},va:function(){var a=g.w>>1,b=~~(0.48*g.t),c=~~(0.75*g.t);g.q&&(g.d.shadowColor="rgba(0,0,0,0)");g.d.textBaseline="alphabetic";g.d.fillStyle="rgba(0,0,0,0.7)";g.d.fillRect(a-255,b-88,510,106);g.d.font="98px arial";g.d.fillStyle="#538";g.d.textAlign="center";g.d.fillText("SQUARE'D",a,b);g.d.font="100px arial";g.d.lineWidth=1;g.d.strokeStyle="#a7f";g.d.textAlign="center";
g.d.strokeText("SQUARE'D",a,b);g.k.B({text:"Press space to start",y:c-18});g.k.B({text:"Controls: Arrow keys or W, A, S, D to move; Mouse to aim and fire",y:c+18})},ua:function(){g.k.B({text:"PAUSED",size:60,color:"#538"});g.k.B({text:"Press space to unpause.",y:(g.t>>1)+100})},v:{x:0,y:0,z:function(){g.q&&(g.d.shadowColor="rgba(0,0,0,0)");g.d.strokeStyle="#0ff";g.d.strokeRect(g.k.v.x-4,g.k.v.y-4,8,8)}}};g.C={c:{ea:function(a){a=g.a.f.types[a];return{size:a.size,speed:a.speed,j:a.j,color:a.color,l:a.l,g:a.g,status:"alive",x:0,y:0,o:0,r:"",u:j,s:j}},fa:function(){var a={x:j,y:j};switch(~~(4*Math.random())){case 0:a.x=~~(Math.random()*g.a.field.width);a.y=0;break;case 1:a.x=~~(Math.random()*g.a.field.width);a.y=g.a.field.height;break;case 2:a.x=0;a.y=~~(Math.random()*g.a.field.height);break;case 3:a.x=g.a.field.width,a.y=~~(Math.random()*g.a.field.height)}return a}},ringers:function(){if(g.a.frame>
100*Math.random()){var a=g.C.c.ea("ringer-weak"),b=g.C.c.fa();a.x=a.S=b.x;a.y=a.T=b.y;a.e=Math.atan2(g.a.b.x-a.x,g.a.b.y-a.y);a.o=~~(4*Math.random())+8;a.u=0.04*Math.random()-0.02;a.s=6E3;g.a.f.D(a)}},survival:function(){var a="dumbo brat dumbo-fat little-red cyanide arrow dumbo-obese".split(" "),b=["ringer-weak","snake"],c="",c=100*Math.random();if(g.a.frame>c)switch(c=g.a.frame/10>c?b[~~(Math.random()*Math.min(~~g.a.frame,b.length-1))]:a[~~(Math.random()*Math.min(~~g.a.frame,a.length-1))],a=g.C.c.ea(c),
b=g.C.c.fa(),a.x=a.S=b.x,a.y=a.T=b.y,a.e=Math.atan2(g.a.b.x-a.x,g.a.b.y-a.y),a.l){case "ringerHub":a.o=~~(4*Math.random())+8;a.u=0.04*Math.random()-0.02;a.s=6E3;g.a.f.D(a);break;case "centipede":a.r="";a.o=~~(10*Math.random())+8;a.u=0.04*Math.random()-0.02;a.s=6E3;g.a.f.D(a);break;default:g.a.f.D(a)}}};g.a.J.push(function(){g.a.b={x:~~(g.w/2),y:~~(g.t/2),j:100,R:k,O:k,P:k,Q:k,$:k,g:25,A:[],da:function(){g.a.b.A.push({x:g.a.b.x,y:g.a.b.y,e:Math.atan2(g.k.v.x-g.a.b.x,g.k.v.y-g.a.b.y)})},N:function(){g.a.b.P&&(0<g.a.b.x&&!g.a.b.Q)&&(g.a.b.x-=0.12*g.a.h);g.a.b.Q&&(g.a.b.x<g.a.field.width&&!g.a.b.P)&&(g.a.b.x+=0.12*g.a.h);g.a.b.R&&(0<g.a.b.y&&!g.a.b.O)&&(g.a.b.y-=0.12*g.a.h);g.a.b.O&&(g.a.b.y<g.a.field.height&&!g.a.b.R)&&(g.a.b.y+=0.12*g.a.h);if(g.a.b.$&&0>=(g.a.b.g-=0.2*g.a.h))g.a.b.da(),g.a.b.g=25;
for(var a,b,c,e,f=0,i=g.a.b.A.length;f<i;++f){e=k;a=g.a.b.A[f];cacheIndex=~~(100*a.e);a.x+=g.c.n[cacheIndex]*0.7*g.a.h;a.y+=g.c.m[cacheIndex]*0.7*g.a.h;c=0;for(var d=Object.keys(g.a.f.i),l=d.length;c<l;++c)if(b=g.a.f.i[d[c]],void 0!==a&&a.x<b.x+b.size&&a.x>b.x-b.size&&a.y<b.y+b.size&&a.y>b.y-b.size&&"dead"!==b.status){b.j--;0<b.j?(b.status="wounded",b.x+=6*g.c.n[cacheIndex],b.y+=6*g.c.m[cacheIndex]):(b.status="dead",b.e=a.e,b.g=100,g.a.V++,b.L={x:a.x,y:a.y});e=h;break}if(!e&&(0>a.x||a.x>g.a.field.width||
0>a.y||a.y>g.a.field.height))e=h;e&&(g.a.b.A.splice(f,1),i--,f--)}},z:function(){var a;g.q&&(g.d.shadowColor="rgba(0,0,0,1)",g.d.shadowBlur=15,g.d.shadowOffsetX=0,g.d.shadowOffsetY=0);g.d.fillStyle="#0f0";g.d.fillRect(g.a.b.x-4,g.a.b.y-4,8,8);g.q&&(g.d.shadowColor="rgba(255,255,0,1)");g.d.strokeStyle="rgba(255, 255, 255, 1)";g.d.lineWidth=4;g.d.beginPath();for(var b,c=0,e=Object.keys(g.a.b.A),f=e.length;c<f;++c)b=g.a.b.A[e[c]],a=~~(100*Math.atan2(g.a.b.x-~~b.x,g.a.b.y-~~b.y)),g.d.moveTo(~~b.x,~~b.y),
g.d.lineTo(~~b.x+18*g.c.n[a],~~b.y+18*g.c.m[a]);g.d.stroke();g.d.closePath()}}});g.a.J.push(function(){g.a.f={ca:0,i:{},F:{wanderChase:function(a){var a=g.a.f.i[a],b=Math.atan2(g.a.b.x-a.x,g.a.b.y-a.y);0>a.g&&(a.e=b,a.g=~~(3900*Math.random())+2300);b=~~(100*a.e);a.x+=g.c.n[b]*a.speed*g.a.h;a.y+=g.c.m[b]*a.speed*g.a.h;a.g-=g.a.h},chase:function(a){a=g.a.f.i[a];a.e=Math.atan2(g.a.b.x-a.x,g.a.b.y-a.y);var b=~~(100*a.e);a.x+=g.c.n[b]*a.speed*g.a.h;a.y+=g.c.m[b]*a.speed*g.a.h},divebomb:function(a){var b=~~(100*g.a.f.i[a].e),a=g.a.f.i[a];a.x+=g.c.n[b]*a.speed*g.a.h;a.y+=g.c.m[b]*a.speed*
g.a.h;if(0>a.x||a.x>g.a.field.width||0>a.y||a.y>g.a.field.height)a.j=0,a.g=0},wanderCurve:function(a){var b=g.a.f.i[a];0<b.s&&(b.s-=g.a.h,0>=b.s&&(b.s=6E3,b.u=0.04*Math.random()-0.02));b.e+=b.u;g.a.f.F.wander(a)},ringerHub:function(a){var b=g.a.f.i[a];if(b.o){for(var c=g.c.K/(b.o-1),e=50*Math.random()+50,f=[-1,1][Math.round(Math.random())]*(0.04*Math.random()+0.06);--b.o;)g.a.f.D({x:b.x,y:b.y,size:32,e:b.o*c,r:a,g:1500,ha:e,l:"ringer",color:"rgba(112,255,152",j:1,u:f,status:"alive",speed:b.speed,
o:b.o-1});b.o=0}g.a.f.F.wanderCurve(a)},ringer:function(a){var b=g.a.f.i[a];if(""===b.r||"dead"===g.a.f.i[b.r].status)return b.l="wander",g.a.f.F.wander(a),h;var a=b.ha,c=g.a.f.i[b.r];0<b.g&&(b.g-=g.a.h,a=(1500-b.g)/1500*b.ha);var e=~~(100*b.e);b.x=g.c.m[e]*a+c.x;b.y=g.c.n[e]*a+c.y;b.e+=b.u;b.e>g.c.U&&(b.e-=g.c.K);b.e<-g.c.U&&(b.e+=g.c.K)},centipede:function(a){var b=g.a.f.i[a];0<b.g&&(b.g-=g.a.h,0>=b.g&&b.o&&(g.a.f.D({x:b.S,y:b.T,S:b.S,T:b.T,size:b.size,e:b.e,s:6E3,u:0.04*Math.random()-0.02,r:a,
g:200,l:"centipede",color:b.color,j:1,status:"alive",speed:b.speed,o:b.o-1}),b.o=0));""===b.r||"dead"===g.a.f.i[b.r].status?(""!==b.r&&(b.r=""),b.color="rgba(220,0,220",g.a.f.F.wanderCurve(a)):(b.color="rgba(140,0,140",a=g.a.f.i[b.r],b.speed=25<g.c.oa(b.x,b.y,a.x,a.y)?0.112:0.05,b.e=Math.atan2(a.x-b.x,a.y-b.y),a=~~(100*b.e),b.x+=g.c.n[a]*b.speed*g.a.h,b.y+=g.c.m[a]*b.speed*g.a.h)},wander:function(a){a=g.a.f.i[a];a.e>g.c.U&&(a.e-=g.c.K);a.e<-g.c.U&&(a.e+=g.c.K);0>a.x?0>a.e&&(a.e=-a.e):a.x>g.a.field.width&&
0<a.e&&(a.e=-a.e);0>a.y?(a.e<-g.c.p&&(a.e=-g.c.p+(-g.c.p-a.e)),a.e>g.c.p&&(a.e=g.c.p+(g.c.p-a.e))):a.y>g.a.field.height&&(0>a.e&&a.e>-g.c.p&&(a.e=-g.c.p+(-g.c.p-a.e)),0<a.e&&a.e<g.c.p&&(a.e=g.c.p+(g.c.p-a.e)));var b=~~(100*a.e);a.x+=g.c.n[b]*a.speed*g.a.h;a.y+=g.c.m[b]*a.speed*g.a.h}},types:{dumbo:{size:46,speed:0.042,j:1,color:"rgba(64,64,255",l:"wander",g:0},brat:{size:22,speed:0.092,j:1,color:"rgba(255,100,0",l:"wander",g:0},"dumbo-fat":{size:52,speed:0.022,j:3,color:"rgba(0,0,180",l:"chase",g:0},
"ringer-weak":{size:22,speed:0.052,j:4,color:"rgba(64,124,84",l:"ringerHub",g:6E3},snake:{size:31,speed:0.112,j:1,color:"rgba(220,0,220",l:"centipede",g:200},"little-red":{size:28,speed:0.09,j:2,color:"rgba(255,0,0",l:"wanderChase",g:3900},cyanide:{size:20,speed:0.064,j:1,color:"rgba(0,255,255",l:"chase",g:0},arrow:{size:30,speed:0.17,j:1,color:"rgba(255,255,0",l:"divebomb",g:0},"dumbo-obese":{size:42,speed:0.032,j:5,color:"rgba(0,0,80",l:"wander",g:0}},D:function(a){g.a.f.ca++;var b="e"+g.a.f.ca;
g.a.f.i[b]=a;return b},N:function(){for(var a,b=0,c=Object.keys(g.a.f.i),e=c.length;b<e;++b)a=g.a.f.i[c[b]],void 0!==a&&"dead"!==a.status&&(g.a.f.F[a.l](c[b]),a.x<g.a.b.x+(a.size>>1)&&(a.x>g.a.b.x-(a.size>>1)&&a.y<g.a.b.y+(a.size>>1)&&a.y>g.a.b.y-(a.size>>1))&&(g.a.I=k))},z:function(){var a=1,b,c,e,f,i;g.q&&(g.d.shadowBlur=5,g.d.shadowOffsetX=3,g.d.shadowOffsetY=3);for(var d,l=0,p=Object.keys(g.a.f.i),s=p.length;l<s;++l)if(d=g.a.f.i[p[l]],i=d.size,"dead"!==d.status)g.q&&(g.d.shadowColor="rgba(0,0,0,1)"),
"wounded"!==d.status?f=d.color+",1)":(d.status="alive",f="rgba(255,255,255,1)"),g.d.fillStyle!==f&&(g.d.fillStyle=f),g.d.fillRect(~~d.x-(i>>1),~~d.y-(i>>1),i,i);else{var r=d.color;100===d.g&&(r="rgba(255,255,255");d.g-=0.1*g.a.h;f=d.g;if(0>=f)delete g.a.f.i[p[l]];else{g.q&&(g.d.shadowColor="rgba(0,0,0,0)");if(90<f){a=3;g.d.strokeStyle="rgba(255, 255, 0, 1)";g.d.lineWidth=4;g.d.beginPath();c=Math.random()*(110-f);for(e=Math.random()*(140-f);--a;)b=~~(628*Math.random()-314),g.d.moveTo(~~(d.L.x+g.c.n[b]*
c),~~(d.L.y+g.c.m[b]*c)),g.d.lineTo(~~(d.L.x+g.c.n[b]*e),~~(d.L.y+g.c.m[b]*e));g.d.stroke();g.d.closePath()}cacheIndex=~~(100*d.e);d.x+=g.c.n[cacheIndex]*0.03*f;d.y+=g.c.m[cacheIndex]*0.03*f;a=(f/100).toFixed(2);g.d.fillStyle=r+","+a+")";i+=~~(i*((100-f)/100));g.d.fillRect(~~d.x-(i>>1),~~d.y-(i>>1),i,i)}}}}});
