for(var h=!0,j=!1,l=0,m=["ms","moz","webkit","o"],p=0;p<m.length&&!window.requestAnimationFrame;++p)window.requestAnimationFrame=window[m[p]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[m[p]+"CancelAnimationFrame"]||window[m[p]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),c=Math.max(0,16-(b-l)),e=window.setTimeout(function(){a(b+c)},c);l=b+c;return e});
window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});window.oa=window.oa||{};window.ha=window.ha||{push:function(){return j}};g={p:h,ba:1,v:900,s:600,Y:0,F:0,canvas:document.getElementById("gamecanvas"),U:document.getElementById("bgcanvas")};g.c=g.canvas.getContext("2d");g.ia=g.U.getContext("2d");g.canvas.setAttribute("width",g.v);g.canvas.setAttribute("height",g.s);g.U.setAttribute("width",g.v);g.U.setAttribute("height",g.s);window.onload=function(){g.a.ea();g.a.ga()};g.d={S:Math.PI,o:Math.PI/2,wa:Math.PI/4,J:2*Math.PI,m:null,n:null,N:400*Math.PI>>0,ma:function(a,b,c,e){a-=c;b-=e;return Math.sqrt(a*a+b*b)},na:function(a){return{left:window.innerWidth/2-a.width/2,top:a.offsetTop}}};g.a={T:0,H:j,paused:j,frame:0.7,h:0,G:Date.now(),I:[],ea:function(){g.p&&(g.c.shadowColor="rgba(0,0,0,0)");g.d.n=[];for(var a=-g.d.N;a<g.d.N;a++)g.d.n[a]=Math.sin(a/100);g.d.m=[];for(a=-g.d.N;a<g.d.N;a++)g.d.m[a]=Math.cos(a/100);g.k.ta();g.a.G=Date.now();g.a.ka()},la:function(){_gaq.push(["_trackEvent","Game","Death","Score",g.a.T]);g.a.ea()},ga:function(){g.a.G=Date.now();g.a.T=0;g.a.frame=1.9;g.a.field.ja();if(g.a.I.length)for(var a=0,b=g.a.I.length;a<b;a++)g.a.I[a]()},pa:function(){g.a.b.Z();g.a.f.Z()},
ra:function(){g.a.field.w();g.a.f.w();g.a.b.w();g.k.u.w();g.k.ua();g.a.H||g.a.la()},W:function(){if(!g.a.H||g.a.paused)return j;var a=Date.now();g.a.h=a-g.a.G;g.a.frame+=2E-5*g.a.h;g.Y++;g.F+=g.a.h;g.a.G=a;g.a.pa();g.a.ra();requestAnimationFrame(g.a.W)},ka:function(){document.onmousemove=function(a){g.k.u.x=(a.pageX-g.a.field.offset.left)/g.ba;g.k.u.y=(a.pageY-g.a.field.offset.top)/g.ba};document.onmousedown=function(a){g.a.b.da();g.a.b.X=h;g.a.b.g=20;a.stopPropagation();return j};document.onmouseup=
function(){g.a.b.X=j};window.onkeydown=function(a){switch(a.keyCode){case 38:case 87:g.a.b.R=h;break;case 37:case 65:g.a.b.P=h;break;case 39:case 68:g.a.b.Q=h;break;case 40:case 83:g.a.b.O=h;break;case 32:g.a.H?g.a.paused?(g.a.G=Date.now(),g.a.paused=j,requestAnimationFrame(g.a.W)):(g.k.sa(),g.a.paused=h,g.Y=0,g.F=0):(g.a.H=h,g.a.ga(),requestAnimationFrame(g.a.W))}};window.onkeyup=function(a){switch(a.keyCode){case 38:case 87:g.a.b.R=j;break;case 37:case 65:g.a.b.P=j;break;case 39:case 68:g.a.b.Q=
j;break;case 40:case 83:g.a.b.O=j}}}};g.a.field={width:g.v,height:g.s,offset:g.d.na(g.canvas),va:"gravel.png",w:function(){g.p&&(g.c.shadowColor="rgba(0,0,0,0)");g.canvas.width=g.canvas.width},ja:function(){var a=document.getElementById("bgimg");g.a.field.V={qa:a,width:a.width,height:a.height};g.ia.drawImage(g.a.field.V.qa,0,0,g.a.field.V.width,g.a.field.V.height,0,0,g.v,g.s)}};g.k={B:function(a){var b={color:"#fff",align:"center",size:15,x:g.v>>1,y:g.s>>1},c;for(c in b)a[c]=a[c]?a[c]:b[c];if(void 0===a.text||!a.text.length)return j;g.p&&(g.c.shadowColor="rgba(0,0,0,0)");g.c.font=a.size+"px arial";b=g.c.measureText(a.text).width;g.c.fillStyle="rgba(0,0,0,0.7)";g.c.fillRect(a.x-(b>>1)-10,a.y-8,b+17,a.size+18);g.c.textAlign=a.align;g.c.textBaseline="top";g.c.fillStyle=a.color;g.c.fillText(a.text,a.x,a.y)},ua:function(){g.k.B({color:"#f0f",text:"Score: "+g.a.T,x:80,y:30});
var a=~~(g.Y/(g.F/1E3));g.k.B({color:"#f0f",text:"FPS: "+a,x:80,y:55});g.p&&(50>a&&1E4<g.F)&&(ctx.shadowColor="rgba(0,0,0,0)",g.p=j)},ta:function(){var a=g.v>>1,b=~~(0.48*g.s),c=~~(0.75*g.s);g.p&&(g.c.shadowColor="rgba(0,0,0,0)");g.c.textBaseline="alphabetic";g.c.fillStyle="rgba(0,0,0,0.7)";g.c.fillRect(a-255,b-88,510,106);g.c.font="98px arial";g.c.fillStyle="#538";g.c.textAlign="center";g.c.fillText("SQUARE'D",a,b);g.c.font="100px arial";g.c.lineWidth=1;g.c.strokeStyle="#a7f";g.c.textAlign="center";
g.c.strokeText("SQUARE'D",a,b);g.k.B({text:"Press space to start",y:c-18});g.k.B({text:"Controls: Arrow keys or W, A, S, D to move; Mouse to aim and fire",y:c+18})},sa:function(){g.k.B({text:"PAUSED",size:60,color:"#538"});g.k.B({text:"Press space to unpause.",y:(g.s>>1)+100})},u:{x:0,y:0,w:function(){g.p&&(g.c.shadowColor="rgba(0,0,0,0)");g.c.strokeStyle="#0ff";g.c.strokeRect(g.k.u.x-4,g.k.u.y-4,8,8)}}};g.a.I.push(function(){g.a.b={x:~~(g.v/2),y:~~(g.s/2),j:100,R:j,O:j,P:j,Q:j,X:j,g:25,A:[],da:function(){g.a.b.A.push({x:g.a.b.x,y:g.a.b.y,e:Math.atan2(g.k.u.x-g.a.b.x,g.k.u.y-g.a.b.y)})},Z:function(){g.a.b.P&&(0<g.a.b.x&&!g.a.b.Q)&&(g.a.b.x-=0.12*g.a.h);g.a.b.Q&&(g.a.b.x<g.a.field.width&&!g.a.b.P)&&(g.a.b.x+=0.12*g.a.h);g.a.b.R&&(0<g.a.b.y&&!g.a.b.O)&&(g.a.b.y-=0.12*g.a.h);g.a.b.O&&(g.a.b.y<g.a.field.height&&!g.a.b.R)&&(g.a.b.y+=0.12*g.a.h);if(g.a.b.X&&0>=(g.a.b.g-=0.2*g.a.h))g.a.b.da(),g.a.b.g=25;
for(var a,b,c,e,f=0,i=g.a.b.A.length;f<i;++f){e=j;a=g.a.b.A[f];cacheIndex=~~(100*a.e);a.x+=g.d.n[cacheIndex]*0.7*g.a.h;a.y+=g.d.m[cacheIndex]*0.7*g.a.h;c=0;for(var d=Object.keys(g.a.f.i),k=d.length;c<k;++c)if(b=g.a.f.i[d[c]],void 0!==a&&a.x<b.x+b.size&&a.x>b.x-b.size&&a.y<b.y+b.size&&a.y>b.y-b.size&&"dead"!==b.status){b.j--;0<b.j?(b.status="wounded",b.x+=6*g.d.n[cacheIndex],b.y+=6*g.d.m[cacheIndex]):(b.status="dead",b.e=a.e,b.g=100,g.a.T++,b.M={x:a.x,y:a.y});e=h;break}if(!e&&(0>a.x||a.x>g.a.field.width||
0>a.y||a.y>g.a.field.height))e=h;e&&(g.a.b.A.splice(f,1),i--,f--)}},w:function(){var a;g.p&&(g.c.shadowColor="rgba(0,0,0,1)",g.c.shadowBlur=15,g.c.shadowOffsetX=0,g.c.shadowOffsetY=0);g.c.fillStyle="#0f0";g.c.fillRect(g.a.b.x-4,g.a.b.y-4,8,8);g.p&&(g.c.shadowColor="rgba(255,255,0,1)");g.c.strokeStyle="rgba(255, 255, 255, 1)";g.c.lineWidth=4;g.c.beginPath();for(var b,c=0,e=Object.keys(g.a.b.A),f=e.length;c<f;++c)b=g.a.b.A[e[c]],a=~~(100*Math.atan2(g.a.b.x-~~b.x,g.a.b.y-~~b.y)),g.c.moveTo(~~b.x,~~b.y),
g.c.lineTo(~~b.x+18*g.d.n[a],~~b.y+18*g.d.m[a]);g.c.stroke();g.c.closePath()}}});g.a.I.push(function(){g.a.f={ca:0,i:{},D:{wanderChase:function(a){var a=g.a.f.i[a],b=Math.atan2(g.a.b.x-a.x,g.a.b.y-a.y);0>a.g&&(a.e=b,a.g=~~(3900*Math.random())+2300);b=~~(100*a.e);a.x+=g.d.n[b]*a.speed*g.a.h;a.y+=g.d.m[b]*a.speed*g.a.h;a.g-=g.a.h},chase:function(a){a=g.a.f.i[a];a.e=Math.atan2(g.a.b.x-a.x,g.a.b.y-a.y);var b=~~(100*a.e);a.x+=g.d.n[b]*a.speed*g.a.h;a.y+=g.d.m[b]*a.speed*g.a.h},divebomb:function(a){var b=~~(100*g.a.f.i[a].e),a=g.a.f.i[a];a.x+=g.d.n[b]*a.speed*g.a.h;a.y+=g.d.m[b]*a.speed*
g.a.h;if(0>a.x||a.x>g.a.field.width||0>a.y||a.y>g.a.field.height)a.j=0,a.g=0},wanderCurve:function(a){var b=g.a.f.i[a];0<b.t&&(b.t-=g.a.h,0>=b.t&&(b.t=6E3,b.z=0.04*Math.random()-0.02));b.e+=b.z;g.a.f.D.wander(a)},ringerHub:function(a){var b=g.a.f.i[a];if(b.K){for(var c=g.d.J/b.K,e=50*Math.random()+50,f=[-1,1][Math.round(Math.random())]*(0.04*Math.random()+0.06);b.K--;)g.a.f.L({x:b.x,y:b.y,size:32,e:b.K*c,q:a,g:1500,fa:e,l:"ringer",color:"rgba(112,255,152",j:1,z:f,status:"alive",speed:b.speed,C:b.C-
1});b.K=0}g.a.f.D.wanderCurve(a)},ringer:function(a){var b=g.a.f.i[a];if(""===b.q||"dead"===g.a.f.i[b.q].status)return b.l="wander",g.a.f.D.wander(a),h;var a=b.fa,c=g.a.f.i[b.q];0<b.g&&(b.g-=g.a.h,a=(1500-b.g)/1500*b.fa);var e=~~(100*b.e);b.x=g.d.m[e]*a+c.x;b.y=g.d.n[e]*a+c.y;b.e+=b.z;b.e>g.d.S&&(b.e-=g.d.J);b.e<-g.d.S&&(b.e+=g.d.J)},centipede:function(a){var b=g.a.f.i[a];0<b.g&&(b.g-=g.a.h,0>=b.g&&b.C&&(g.a.f.L({x:b.$,y:b.aa,$:b.$,aa:b.aa,size:b.size,e:b.e,t:6E3,z:0.04*Math.random()-0.02,q:a,g:200,
l:"centipede",color:b.color,j:1,status:"alive",speed:b.speed,C:b.C-1}),b.C=0));""===b.q||"dead"===g.a.f.i[b.q].status?(""!==b.q&&(b.q=""),b.color="rgba(220,0,220",g.a.f.D.wanderCurve(a)):(b.color="rgba(140,0,140",a=g.a.f.i[b.q],b.speed=25<g.d.ma(b.x,b.y,a.x,a.y)?0.112:0.05,b.e=Math.atan2(a.x-b.x,a.y-b.y),a=~~(100*b.e),b.x+=g.d.n[a]*b.speed*g.a.h,b.y+=g.d.m[a]*b.speed*g.a.h)},wander:function(a){a=g.a.f.i[a];a.e>g.d.S&&(a.e-=g.d.J);a.e<-g.d.S&&(a.e+=g.d.J);0>a.x?0>a.e&&(a.e=-a.e):a.x>g.a.field.width&&
0<a.e&&(a.e=-a.e);0>a.y?(a.e<-g.d.o&&(a.e=-g.d.o+(-g.d.o-a.e)),a.e>g.d.o&&(a.e=g.d.o+(g.d.o-a.e))):a.y>g.a.field.height&&(0>a.e&&a.e>-g.d.o&&(a.e=-g.d.o+(-g.d.o-a.e)),0<a.e&&a.e<g.d.o&&(a.e=g.d.o+(g.d.o-a.e)));var b=~~(100*a.e);a.x+=g.d.n[b]*a.speed*g.a.h;a.y+=g.d.m[b]*a.speed*g.a.h}},types:[{size:46,speed:0.042,j:1,color:"rgba(64,64,255",l:"wander",g:0,r:1},{size:22,speed:0.092,j:1,color:"rgba(255,100,0",l:"wander",g:0,r:1},{size:52,speed:0.022,j:3,color:"rgba(0,0,180",l:"chase",g:0,r:1},{size:22,
speed:0.052,j:4,color:"rgba(64,124,84",l:"ringerHub",g:6E3,r:0.1},{size:31,speed:0.112,j:1,color:"rgba(220,0,220",l:"centipede",g:200,r:0.1},{size:28,speed:0.09,j:2,color:"rgba(255,0,0",l:"wanderChase",g:3900,r:1},{size:20,speed:0.064,j:1,color:"rgba(0,255,255",l:"chase",g:0,r:1},{size:30,speed:0.17,j:1,color:"rgba(255,255,0",l:"divebomb",g:0,r:1},{size:42,speed:0.032,j:5,color:"rgba(0,0,80",l:"wander",g:0,r:1}],L:function(a){g.a.f.ca++;var b="e"+g.a.f.ca;g.a.f.i[b]=a;return b},Z:function(){if(g.a.frame>
100*Math.random()){var a=~~(4*Math.random()),b=~~(Math.random()*Math.min(~~g.a.frame,g.a.f.types.length-1)),b=g.a.f.types[b];if(1===b.r||Math.random()<b.r){b={size:b.size,speed:b.speed,j:b.j,color:b.color,l:b.l,g:b.g,status:"alive",x:0,y:0};switch(a){case 0:b.x=~~(Math.random()*g.a.field.width);b.y=0;break;case 1:b.x=~~(Math.random()*g.a.field.width);b.y=g.a.field.height;break;case 2:b.x=0;b.y=~~(Math.random()*g.a.field.height);break;case 3:b.x=g.a.field.width,b.y=~~(Math.random()*g.a.field.height)}b.e=
Math.atan2(g.a.b.x-b.x,g.a.b.y-b.y);switch(b.l){case "ringerHub":b.K=~~(4*Math.random())+8;b.z=0.04*Math.random()-0.02;b.t=6E3;g.a.f.L(b);break;case "centipede":b.q="";b.C=~~(10*Math.random())+8;b.$=b.x;b.aa=b.y;b.z=0.04*Math.random()-0.02;b.t=6E3;g.a.f.L(b);break;default:g.a.f.L(b)}}}for(var b=0,c=Object.keys(g.a.f.i),e=c.length;b<e;++b)a=g.a.f.i[c[b]],void 0!==a&&"dead"!==a.status&&(g.a.f.D[a.l](c[b]),a.x<g.a.b.x+(a.size>>1)&&(a.x>g.a.b.x-(a.size>>1)&&a.y<g.a.b.y+(a.size>>1)&&a.y>g.a.b.y-(a.size>>
1))&&(g.a.H=j))},w:function(){var a=1,b,c,e,f,i;g.p&&(g.c.shadowBlur=5,g.c.shadowOffsetX=3,g.c.shadowOffsetY=3);for(var d,k=0,n=Object.keys(g.a.f.i),r=n.length;k<r;++k)if(d=g.a.f.i[n[k]],i=d.size,"dead"!==d.status)g.p&&(g.c.shadowColor="rgba(0,0,0,1)"),"wounded"!==d.status?f=d.color+",1)":(d.status="alive",f="rgba(255,255,255,1)"),g.c.fillStyle!==f&&(g.c.fillStyle=f),g.c.fillRect(~~d.x-(i>>1),~~d.y-(i>>1),i,i);else{var q=d.color;100===d.g&&(q="rgba(255,255,255");d.g-=0.1*g.a.h;f=d.g;if(0>=f)delete g.a.f.i[n[k]];
else{g.p&&(g.c.shadowColor="rgba(0,0,0,0)");if(90<f){a=3;g.c.strokeStyle="rgba(255, 255, 0, 1)";g.c.lineWidth=4;g.c.beginPath();c=Math.random()*(110-f);for(e=Math.random()*(140-f);--a;)b=~~(628*Math.random()-314),g.c.moveTo(~~(d.M.x+g.d.n[b]*c),~~(d.M.y+g.d.m[b]*c)),g.c.lineTo(~~(d.M.x+g.d.n[b]*e),~~(d.M.y+g.d.m[b]*e));g.c.stroke();g.c.closePath()}cacheIndex=~~(100*d.e);d.x+=g.d.n[cacheIndex]*0.03*f;d.y+=g.d.m[cacheIndex]*0.03*f;a=(f/100).toFixed(2);g.c.fillStyle=q+","+a+")";i+=~~(i*((100-f)/100));
g.c.fillRect(~~d.x-(i>>1),~~d.y-(i>>1),i,i)}}}}});
