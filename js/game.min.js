for(var b=!0,c=!1,f=0,h=["ms","moz","webkit","o"],i=0;i<h.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[h[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[h[i]+"CancelAnimationFrame"]||window[h[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var e=(new Date).getTime(),d=Math.max(0,16-(e-f)),n=window.setTimeout(function(){a(e+d)},d);f=e+d;return n});
window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});function j(a){var e={color:"#fff",align:"center",size:15,x:k>>1,y:l>>1},d;for(d in e)a[d]=a[d]?a[d]:e[d];"undefined"===typeof a.text||0===a.text.length||(p&&(q.shadowColor="rgba(0,0,0,0)"),q.font=a.size+"px arial",e=q.measureText(a.text).width,q.fillStyle="rgba(0,0,0,0.7)",q.fillRect(a.x-(e>>1)-10,a.y-8,e+17,a.size+18),q.textAlign=a.align,q.textBaseline="top",q.fillStyle=a.color,q.fillText(a.text,a.x,a.y))}
function r(){var a=k>>1,e=~~(0.48*l),d=~~(0.75*l);p&&(q.shadowColor="rgba(0,0,0,0)");q.textBaseline="alphabetic";q.fillStyle="rgba(0,0,0,0.7)";q.fillRect(a-255,e-88,510,106);q.font="98px arial";q.fillStyle="#538";q.textAlign="center";q.fillText("SQUARE'D",a,e);q.font="100px arial";q.lineWidth=1;q.strokeStyle="#a7f";q.textAlign="center";q.strokeText("SQUARE'D",a,e);j({text:"Press space to start",y:d-18});j({text:"Controls: W, A, S, D to move; Mouse to aim and fire",y:d+18});t=Date.now()}
function u(){t=Date.now();v=0;w=0.7;x={x:~~(k/2),y:~~(l/2),e:100,l:c,i:c,j:c,k:c,o:c,d:25,c:[],q:function(){this.c.push({x:this.x,y:this.y,b:Math.atan2(y.x-this.x,y.y-this.y)})},p:function(){this.j&&(0<this.x&&!this.k)&&(this.x-=0.12*z);x.k&&(this.x<A.width&&!this.j)&&(this.x+=0.12*z);this.l&&(0<this.y&&!this.i)&&(this.y-=0.12*z);this.i&&(this.y<A.height&&!this.l)&&(this.y+=0.12*z);if(this.o&&0>=(this.d-=0.2*z))this.q(),this.d=25;for(var a in this.c){var e=~~(100*this.c[a].b);this.c[a].x+=B[e]*0.5*
z;this.c[a].y+=C[e]*0.5*z;for(var d in D.a)if(void 0!==this.c[a]&&this.c[a].x<D.a[d].x+D.a[d].size&&this.c[a].x>D.a[d].x-D.a[d].size&&this.c[a].y<D.a[d].y+D.a[d].size&&this.c[a].y>D.a[d].y-D.a[d].size&&0<D.a[d].e){--D.a[d].e||(D.a[d].b=this.c[a].b,D.a[d].d=100,v++,D.a[d].h={x:this.c[a].x,y:this.c[a].y});this.c.splice(a,1);break}void 0!==this.c[a]&&(0>~~this.c[a].x||~~this.c[a].x>A.width||0>~~this.c[a].y||~~this.c[a].y>A.height)&&this.c.splice(a,1)}},g:function(){p&&(q.shadowColor="rgba(0,0,0,1)");
p&&(q.shadowBlur=5);p&&(q.shadowOffsetX=3);p&&(q.shadowOffsetY=3);q.fillStyle="#0f0";q.fillRect(x.x-4,x.y-4,8,8);p&&(q.shadowColor="rgba(255,255,0,0)");q.fillStyle="rgba(255,255,255,1)";for(var a in this.c)q.fillRect(~~this.c[a].x,~~this.c[a].y,3,3)}};D={a:[],r:{wanderChase:function(a){var e=Math.atan2(x.x-D.a[a].x,x.y-D.a[a].y);0>D.a[a].d&&(D.a[a].b=e,D.a[a].d=~~(900*Math.random())+300);e=~~(100*D.a[a].b);D.a[a].x+=B[e]*D.a[a].speed*z;D.a[a].y+=C[e]*D.a[a].speed*z;D.a[a].d-=z},chase:function(a){D.a[a].b=
Math.atan2(x.x-D.a[a].x,x.y-D.a[a].y);var e=~~(100*D.a[a].b);D.a[a].x+=B[e]*D.a[a].speed*z;D.a[a].y+=C[e]*D.a[a].speed*z},divebomb:function(a){var e=~~(100*D.a[a].b);D.a[a].x+=B[e]*D.a[a].speed*z;D.a[a].y+=C[e]*D.a[a].speed*z;if(0>D.a[a].x||D.a[a].x>A.width||0>D.a[a].y||D.a[a].y>A.height)D.a[a].e=0,D.a[a].d=0},wander:function(a){D.a[a].b>E&&(D.a[a].b-=F);D.a[a].b<-E&&(D.a[a].b+=F);0>D.a[a].x&&0>D.a[a].b&&(D.a[a].b=-D.a[a].b);D.a[a].x>A.width&&0<D.a[a].b&&(D.a[a].b=-D.a[a].b);0>D.a[a].y&&(D.a[a].b<
-G&&(D.a[a].b=-G+(-G-D.a[a].b)),D.a[a].b>G&&(D.a[a].b=G+(G-D.a[a].b)));D.a[a].y>A.height&&(0>D.a[a].b&&D.a[a].b>-G&&(D.a[a].b=-G+(-G-D.a[a].b)),0<D.a[a].b&&D.a[a].b<G&&(D.a[a].b=G+(G-D.a[a].b)));var e=~~(100*D.a[a].b);D.a[a].x+=B[e]*D.a[a].speed*z;D.a[a].y+=C[e]*D.a[a].speed*z}},types:[{size:36,speed:0.038,e:1,color:"rgba(255,0,0",f:"wander"},{size:20,speed:0.082,e:1,color:"rgba(255,100,0",f:"wander"},{size:52,speed:0.022,e:3,color:"rgba(255,0,120",f:"chase"},{size:28,speed:0.102,e:2,color:"rgba(255,255,0",
f:"wanderChase",d:2900},{size:22,speed:0.064,e:1,color:"rgba(0,255,255",f:"chase"},{size:30,speed:0.17,e:1,color:"rgba(255,120,120",f:"divebomb"},{size:42,speed:0.032,e:5,color:"rgba(255,155,255",f:"wander"}],m:function(a,e,d){var d=d+"",a={x:a,y:e,b:Math.atan2(x.x-a,x.y-e)},n;for(n in this.types[d])a[n]=a[n]?a[n]:this.types[d][n];this.a.push(a)},p:function(){if(w>100*Math.random()){var a=~~(4*Math.random()),e=~~(Math.random()*~~w);e>this.types.length-1&&(e=this.types.length-1);switch(a){case 0:this.m(~~(Math.random()*
A.width),0,e);break;case 1:this.m(~~(Math.random()*A.width),A.height,e);break;case 2:this.m(0,~~(Math.random()*A.height),e);break;case 3:this.m(A.width,~~(Math.random()*A.height),e)}}for(var d in D.a)void 0!==this.a[d]&&this.a[d].e&&(this.r[this.a[d].f](d),this.a[d].x<x.x+(this.a[d].size>>1)&&(this.a[d].x>x.x-(this.a[d].size>>1)&&this.a[d].y<x.y+(this.a[d].size>>1)&&this.a[d].y>x.y-(this.a[d].size>>1))&&(clearInterval(H),I=c))},g:function(){var a=1,e,d,n,s,m;p&&(q.shadowBlur=5);p&&(q.shadowOffsetX=
3);p&&(q.shadowOffsetY=3);for(var g in this.a)if(void 0!==this.a[g])if(m=this.a[g].size,this.a[g].e)p&&(q.shadowColor="rgba(0,0,0,1)"),s=this.a[g].color+",1)",q.fillStyle!==s&&(q.fillStyle=this.a[g].color+",1)"),q.fillRect(~~this.a[g].x-(m>>1),~~this.a[g].y-(m>>1),m,m);else if(this.a[g].d-=0.1*z,s=this.a[g].d){p&&(q.shadowColor="rgba(0,0,0,0)");if(84<s){a=3;q.strokeStyle="rgba(255, 255, 0, 1)";q.lineWidth=2;q.beginPath();d=Math.random()*(110-s);for(n=Math.random()*(140-s);--a;)e=~~(628*Math.random()-
314),q.moveTo(~~(this.a[g].h.x+B[e]*d),~~(this.a[g].h.y+C[e]*d)),q.lineTo(~~(this.a[g].h.x+B[e]*n),~~(this.a[g].h.y+C[e]*n));q.stroke();q.closePath()}cacheIndex=~~(100*this.a[g].b);this.a[g].x+=B[cacheIndex]*0.01*s;this.a[g].y+=C[cacheIndex]*0.01*s;a=(s/100).toFixed(2);q.fillStyle=this.a[g].color+","+a+")";m+=~~(m*((100-s)/100));q.fillRect(~~this.a[g].x-(m>>1),~~this.a[g].y-(m>>1),m,m)}else this.a.splice(g,1)}}}
function J(){if(!I||K)return c;var a=Date.now();z=a-t;w+=2E-5*z;L++;M+=z;t=a;x.p();D.p();A.g();D.g();x.g();y.g();j({color:"#f0f",text:"Score: "+v,x:80,y:30});a=~~(L/(M/1E3));j({color:"#f0f",text:"FPS: "+a,x:80,y:55});p&&(50>a&&1E4<M)&&(q.shadowColor="rgba(0,0,0,0)",p=c);I||r();requestAnimationFrame(J)}var N,q,x={},A={},D={},w=0.7,v=0,H,I=c,K=c,E=Math.PI,G=Math.PI/2,F=2*Math.PI,k,l,C,B,O=200*F>>0,y={},z=0,L=0,M=0,p=b,t=Date.now();B=[];for(var P=-O;P<O;P++)B[P]=Math.sin(P/100);C=[];
for(P=-O;P<O;P++)C[P]=Math.cos(P/100);k=900;l=660;N=document.getElementById("gamecanvas");q=N.getContext("2d");bgcanvas=document.getElementById("bgcanvas");bgctx=bgcanvas.getContext("2d");N.setAttribute("width",k);N.setAttribute("height",l);bgcanvas.setAttribute("width",k);bgcanvas.setAttribute("height",l);function Q(){var a=document.getElementById("bgimg");A.n={s:a,width:a.width,height:a.height};bgctx.drawImage(A.n.s,0,0,A.n.width,A.n.height,0,0,k,l)}document.getElementById("bgimg").onload=Q;
document.getElementById("bgimg").complete&&Q();A={width:k,height:l,offset:{left:window.innerWidth/2-N.width/2,top:N.offsetTop},t:"gravel.png",g:function(){p&&(q.shadowColor="rgba(0,0,0,0)");N.width=N.width}};y={x:0,y:0,g:function(){p&&(q.shadowColor="rgba(0,0,0,0)");q.strokeStyle="#0ff";q.strokeRect(y.x-4,y.y-4,8,8)}};p&&(q.shadowColor="rgba(0,0,0,0)");q.fillStyle="#000";q.fillRect(0,0,k,l);document.onmousemove=function(a){y.x=(a.pageX-A.offset.left)/1;y.y=(a.pageY-A.offset.top)/1};
document.onmousedown=function(a){x.q();x.o=b;x.d=20;a.stopPropagation();return c};document.onmouseup=function(){x.o=c};window.onkeydown=function(a){switch(a.keyCode){case 87:x.l=b;break;case 65:x.j=b;break;case 68:x.k=b;break;case 83:x.i=b;break;case 32:I?K?(t=Date.now(),K=c,requestAnimationFrame(J)):(j({text:"PAUSED",size:60,color:"#538"}),j({text:"Press space to unpause.",y:(l>>1)+100}),K=b,M=L=0):(I=b,u(),requestAnimationFrame(J))}};
window.onkeyup=function(a){switch(a.keyCode){case 87:x.l=c;break;case 65:x.j=c;break;case 68:x.k=c;break;case 83:x.i=c}};r();u();
