for(var h=!0,j=!1,l=0,m=["ms","moz","webkit","o"],p=0;p<m.length&&!window.requestAnimationFrame;++p)window.requestAnimationFrame=window[m[p]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[m[p]+"CancelAnimationFrame"]||window[m[p]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),c=Math.max(0,16-(b-l)),e=window.setTimeout(function(){a(b+c)},c);l=b+c;return e});
window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});window.la=window.la||{};window.fa=window.fa||{push:function(){return j}};g={p:h,Z:1,t:900,q:600,ba:0,T:0,canvas:document.getElementById("gamecanvas"),Q:document.getElementById("bgcanvas")};g.c=g.canvas.getContext("2d");g.ga=g.Q.getContext("2d");g.canvas.setAttribute("width",g.t);g.canvas.setAttribute("height",g.q);g.Q.setAttribute("width",g.t);g.Q.setAttribute("height",g.q);window.onload=function(){g.p&&(g.c.shadowColor="rgba(0,0,0,0)");g.c.fillStyle="#000";g.c.fillRect(0,0,g.t,g.q);g.a.ca();g.a.ea()};g.d={O:Math.PI,o:Math.PI/2,sa:Math.PI/4,F:2*Math.PI,l:null,m:null,J:400*Math.PI>>0,ja:function(a,b,c,e){a-=c;b-=e;return Math.sqrt(a*a+b*b)},ka:function(a){return{left:window.innerWidth/2-a.width/2,top:a.offsetTop}}};g.a={P:0,V:j,paused:j,frame:0.7,h:0,U:Date.now(),D:[],ca:function(){g.d.m=[];for(var a=-g.d.J;a<g.d.J;a++)g.d.m[a]=Math.sin(a/100);g.d.l=[];for(a=-g.d.J;a<g.d.J;a++)g.d.l[a]=Math.cos(a/100);g.n.pa();g.a.U=Date.now();g.a.ia()},qa:function(){_gaq.push(["_trackEvent","Game","Death","Score",g.a.P]);g.a.ca()},ea:function(){g.a.U=Date.now();g.a.P=0;g.a.frame=1.9;g.a.field.ha();if(g.a.D.length)for(var a=0,b=g.a.D.length;a<b;a++)g.a.D[a]()},ia:function(){document.onmousemove=function(a){g.n.z.x=(a.pageX-
g.a.field.offset.left)/g.Z;g.n.z.y=(a.pageY-g.a.field.offset.top)/g.Z};document.onmousedown=function(a){g.a.b.aa();g.a.b.S=h;g.a.b.f=20;a.stopPropagation();return j};document.onmouseup=function(){g.a.b.S=j};window.onkeydown=function(a){switch(a.keyCode){case 38:case 87:g.a.b.N=h;break;case 37:case 65:g.a.b.L=h;break;case 39:case 68:g.a.b.M=h;break;case 40:case 83:g.a.b.K=h;break;case 32:g.a.V?g.a.paused?(g.a.U=Date.now(),g.a.paused=j,requestAnimationFrame(doFrame)):(g.n.oa(),g.a.paused=h,g.ba=0,g.T=
0):(g.a.V=h,g.a.ea(),requestAnimationFrame(doFrame))}};window.onkeyup=function(a){switch(a.keyCode){case 38:case 87:g.a.b.N=j;break;case 37:case 65:g.a.b.L=j;break;case 39:case 68:g.a.b.M=j;break;case 40:case 83:g.a.b.K=j}}}};g.a.field={width:g.t,height:g.q,offset:g.d.ka(g.canvas),ra:"gravel.png",Y:function(){g.p&&(g.c.shadowColor="rgba(0,0,0,0)");g.canvas.width=g.canvas.width},ha:function(){var a=document.getElementById("bgimg");g.a.field.R={ma:a,width:a.width,height:a.height};g.ga.drawImage(g.a.field.R.ma,0,0,g.a.field.R.width,g.a.field.R.height,0,0,g.t,g.q)}};g.n={A:function(a){var b={color:"#fff",align:"center",size:15,x:g.t>>1,y:g.q>>1},c;for(c in b)a[c]=a[c]?a[c]:b[c];if(void 0===a.text||!a.text.length)return j;g.p&&(g.c.shadowColor="rgba(0,0,0,0)");g.c.font=a.size+"px arial";b=g.c.measureText(a.text).width;g.c.fillStyle="rgba(0,0,0,0.7)";g.c.fillRect(a.x-(b>>1)-10,a.y-8,b+17,a.size+18);g.c.textAlign=a.align;g.c.textBaseline="top";g.c.fillStyle=a.color;g.c.fillText(a.text,a.x,a.y)},ta:function(){g.n.A({color:"#f0f",text:"Score: "+g.a.P,x:80,y:30});
var a=~~(g.ba/(g.T/1E3));g.n.A({color:"#f0f",text:"FPS: "+a,x:80,y:55});g.p&&(50>a&&1E4<g.T)&&(ctx.shadowColor="rgba(0,0,0,0)",g.p=j)},pa:function(){var a=g.t>>1,b=~~(0.48*g.q),c=~~(0.75*g.q);g.p&&(g.c.shadowColor="rgba(0,0,0,0)");g.c.textBaseline="alphabetic";g.c.fillStyle="rgba(0,0,0,0.7)";g.c.fillRect(a-255,b-88,510,106);g.c.font="98px arial";g.c.fillStyle="#538";g.c.textAlign="center";g.c.fillText("SQUARE'D",a,b);g.c.font="100px arial";g.c.lineWidth=1;g.c.strokeStyle="#a7f";g.c.textAlign="center";
g.c.strokeText("SQUARE'D",a,b);g.n.A({text:"Press space to start",y:c-18});g.n.A({text:"Controls: Arrow keys or W, A, S, D to move; Mouse to aim and fire",y:c+18})},oa:function(){g.n.A({text:"PAUSED",size:60,color:"#538"});g.n.A({text:"Press space to unpause.",y:(g.q>>1)+100})},z:{x:0,y:0,Y:function(){g.p&&(g.c.shadowColor="rgba(0,0,0,0)");g.c.strokeStyle="#0ff";g.c.strokeRect(g.n.z.x-4,g.n.z.y-4,8,8)}}};g.a.D.push(function(){g.a.b={x:~~(g.t/2),y:~~(g.q/2),j:100,N:j,K:j,L:j,M:j,S:j,f:25,w:[],aa:function(){g.a.b.w.push({x:g.a.b.x,y:g.a.b.y,e:Math.atan2(g.n.z.x-g.a.b.x,g.n.z.y-g.a.b.y)})},na:function(){g.a.b.L&&(0<g.a.b.x&&!g.a.b.M)&&(g.a.b.x-=0.12*g.a.h);g.a.b.M&&(g.a.b.x<g.a.field.width&&!g.a.b.L)&&(g.a.b.x+=0.12*g.a.h);g.a.b.N&&(0<g.a.b.y&&!g.a.b.K)&&(g.a.b.y-=0.12*g.a.h);g.a.b.K&&(g.a.b.y<g.a.field.height&&!g.a.b.N)&&(g.a.b.y+=0.12*g.a.h);if(g.a.b.S&&0>=(g.a.b.f-=0.2*g.a.h))g.a.b.aa(),g.a.b.f=25;
for(var a,b,c,e,f=0,i=g.a.b.w.length;f<i;++f){e=j;a=g.a.b.w[f];cacheIndex=~~(100*a.e);a.x+=g.d.m[cacheIndex]*0.7*g.a.h;a.y+=g.d.l[cacheIndex]*0.7*g.a.h;c=0;for(var d=Object.keys(g.a.g.i),k=d.length;c<k;++c)if(b=g.a.g.i[d[c]],void 0!==a&&a.x<b.x+b.size&&a.x>b.x-b.size&&a.y<b.y+b.size&&a.y>b.y-b.size&&"dead"!==b.status){b.j--;0<b.j?(b.status="wounded",b.x+=6*g.d.m[cacheIndex],b.y+=6*g.d.l[cacheIndex]):(b.status="dead",b.e=a.e,b.f=100,g.a.P++,b.I={x:a.x,y:a.y});e=h;break}if(!e&&(0>a.x||a.x>g.a.field.width||
0>a.y||a.y>g.a.field.height))e=h;e&&(g.a.b.w.splice(f,1),i--,f--)}},Y:function(){var a;g.p&&(g.c.shadowColor="rgba(0,0,0,1)",g.c.shadowBlur=15,g.c.shadowOffsetX=0,g.c.shadowOffsetY=0);g.c.fillStyle="#0f0";g.c.fillRect(g.a.b.x-4,g.a.b.y-4,8,8);g.p&&(g.c.shadowColor="rgba(255,255,0,1)");g.c.strokeStyle="rgba(255, 255, 255, 1)";g.c.lineWidth=4;g.c.beginPath();for(var b,c=0,e=Object.keys(g.a.b.w),f=e.length;c<f;++c)b=g.a.b.w[e[c]],a=~~(100*Math.atan2(g.a.b.x-~~b.x,g.a.b.y-~~b.y)),g.c.moveTo(~~b.x,~~b.y),
g.c.lineTo(~~b.x+18*g.d.m[a],~~b.y+18*g.d.l[a]);g.c.stroke();g.c.closePath()}}});g.a.D.push(function(){g.a.g={$:0,i:{},C:{wanderChase:function(a){var a=g.a.g.i[a],b=Math.atan2(g.a.b.x-a.x,g.a.b.y-a.y);0>a.f&&(a.e=b,a.f=~~(3900*Math.random())+2300);b=~~(100*a.e);a.x+=g.d.m[b]*a.speed*g.a.h;a.y+=g.d.l[b]*a.speed*g.a.h;a.f-=g.a.h},chase:function(a){a=g.a.g.i[a];a.e=Math.atan2(g.a.b.x-a.x,g.a.b.y-a.y);var b=~~(100*a.e);a.x+=g.d.m[b]*a.speed*g.a.h;a.y+=g.d.l[b]*a.speed*g.a.h},divebomb:function(a){var b=~~(100*g.a.g.i[a].e),a=g.a.g.i[a];a.x+=g.d.m[b]*a.speed*g.a.h;a.y+=g.d.l[b]*a.speed*
g.a.h;if(0>a.x||a.x>g.a.field.width||0>a.y||a.y>g.a.field.height)a.j=0,a.f=0},wanderCurve:function(a){var b=g.a.g.i[a];0<b.u&&(b.u-=g.a.h,0>=b.u&&(b.u=6E3,b.v=0.04*Math.random()-0.02));b.e+=b.v;g.a.g.C.wander(a)},ringerHub:function(a){var b=g.a.g.i[a];if(b.G){for(var c=g.d.F/b.G,e=50*Math.random()+50,f=[-1,1][Math.round(Math.random())]*(0.04*Math.random()+0.06);b.G--;)g.a.g.H({x:b.x,y:b.y,size:32,e:b.G*c,r:a,f:1500,da:e,k:"ringer",color:"rgba(112,255,152",j:1,v:f,status:"alive",speed:b.speed,B:b.B-
1});b.G=0}g.a.g.C.wanderCurve(a)},ringer:function(a){var b=g.a.g.i[a];if(""===b.r||"dead"===g.a.g.i[b.r].status)return b.k="wander",g.a.g.C.wander(a),h;var a=b.da,c=g.a.g.i[b.r];0<b.f&&(b.f-=g.a.h,a=(1500-b.f)/1500*b.da);var e=~~(100*b.e);b.x=g.d.l[e]*a+c.x;b.y=g.d.m[e]*a+c.y;b.e+=b.v;b.e>g.d.O&&(b.e-=g.d.F);b.e<-g.d.O&&(b.e+=g.d.F)},centipede:function(a){var b=g.a.g.i[a];0<b.f&&(b.f-=g.a.h,0>=b.f&&b.B&&(g.a.g.H({x:b.W,y:b.X,W:b.W,X:b.X,size:b.size,e:b.e,u:6E3,v:0.04*Math.random()-0.02,r:a,f:200,
k:"centipede",color:b.color,j:1,status:"alive",speed:b.speed,B:b.B-1}),b.B=0));""===b.r||"dead"===g.a.g.i[b.r].status?(""!==b.r&&(b.r=""),b.color="rgba(220,0,220",g.a.g.C.wanderCurve(a)):(b.color="rgba(140,0,140",a=g.a.g.i[b.r],b.speed=25<g.d.ja(b.x,b.y,a.x,a.y)?0.112:0.05,b.e=Math.atan2(a.x-b.x,a.y-b.y),a=~~(100*b.e),b.x+=g.d.m[a]*b.speed*g.a.h,b.y+=g.d.l[a]*b.speed*g.a.h)},wander:function(a){a=g.a.g.i[a];a.e>g.d.O&&(a.e-=g.d.F);a.e<-g.d.O&&(a.e+=g.d.F);0>a.x?0>a.e&&(a.e=-a.e):a.x>g.a.field.width&&
0<a.e&&(a.e=-a.e);0>a.y?(a.e<-g.d.o&&(a.e=-g.d.o+(-g.d.o-a.e)),a.e>g.d.o&&(a.e=g.d.o+(g.d.o-a.e))):a.y>g.a.field.height&&(0>a.e&&a.e>-g.d.o&&(a.e=-g.d.o+(-g.d.o-a.e)),0<a.e&&a.e<g.d.o&&(a.e=g.d.o+(g.d.o-a.e)));var b=~~(100*a.e);a.x+=g.d.m[b]*a.speed*g.a.h;a.y+=g.d.l[b]*a.speed*g.a.h}},types:[{size:46,speed:0.042,j:1,color:"rgba(64,64,255",k:"wander",f:0,s:1},{size:22,speed:0.092,j:1,color:"rgba(255,100,0",k:"wander",f:0,s:1},{size:52,speed:0.022,j:3,color:"rgba(0,0,180",k:"chase",f:0,s:1},{size:22,
speed:0.052,j:4,color:"rgba(64,124,84",k:"ringerHub",f:6E3,s:0.1},{size:31,speed:0.112,j:1,color:"rgba(220,0,220",k:"centipede",f:200,s:0.1},{size:28,speed:0.09,j:2,color:"rgba(255,0,0",k:"wanderChase",f:3900,s:1},{size:20,speed:0.064,j:1,color:"rgba(0,255,255",k:"chase",f:0,s:1},{size:30,speed:0.17,j:1,color:"rgba(255,255,0",k:"divebomb",f:0,s:1},{size:42,speed:0.032,j:5,color:"rgba(0,0,80",k:"wander",f:0,s:1}],H:function(a){g.a.g.$++;var b="e"+g.a.g.$;g.a.g.i[b]=a;return b},na:function(){if(g.a.frame>
100*Math.random()){var a=~~(4*Math.random()),b=~~(Math.random()*Math.min(~~g.a.frame,g.a.g.types.length-1)),b=g.a.g.types[b];if(1===b.s||Math.random()<b.s){b={size:b.size,speed:b.speed,j:b.j,color:b.color,k:b.k,f:b.f,status:"alive",x:0,y:0};switch(a){case 0:b.x=~~(Math.random()*g.a.field.width);b.y=0;break;case 1:b.x=~~(Math.random()*g.a.field.width);b.y=g.a.field.height;break;case 2:b.x=0;b.y=~~(Math.random()*g.a.field.height);break;case 3:b.x=g.a.field.width,b.y=~~(Math.random()*g.a.field.height)}b.e=
Math.atan2(g.a.b.x-b.x,g.a.b.y-b.y);switch(b.k){case "ringerHub":b.G=~~(4*Math.random())+8;b.v=0.04*Math.random()-0.02;b.u=6E3;g.a.g.H(b);break;case "centipede":b.r="";b.B=~~(10*Math.random())+8;b.W=b.x;b.X=b.y;b.v=0.04*Math.random()-0.02;b.u=6E3;g.a.g.H(b);break;default:g.a.g.H(b)}}}for(var b=0,c=Object.keys(g.a.g.i),e=c.length;b<e;++b)a=g.a.g.i[c[b]],void 0!==a&&"dead"!==a.status&&(g.a.g.C[a.k](c[b]),a.x<g.a.b.x+(a.size>>1)&&(a.x>g.a.b.x-(a.size>>1)&&a.y<g.a.b.y+(a.size>>1)&&a.y>g.a.b.y-(a.size>>
1))&&(g.a.V=j))},Y:function(){var a=1,b,c,e,f,i;g.p&&(g.c.shadowBlur=5,g.c.shadowOffsetX=3,g.c.shadowOffsetY=3);for(var d,k=0,n=Object.keys(g.a.g.i),r=n.length;k<r;++k)if(d=g.a.g.i[n[k]],i=d.size,"dead"!==d.status)g.p&&(g.c.shadowColor="rgba(0,0,0,1)"),"wounded"!==d.status?f=d.color+",1)":(d.status="alive",f="rgba(255,255,255,1)"),g.c.fillStyle!==f&&(g.c.fillStyle=f),g.c.fillRect(~~d.x-(i>>1),~~d.y-(i>>1),i,i);else{var q=d.color;100===d.f&&(q="rgba(255,255,255");d.f-=0.1*g.a.h;f=d.f;if(0>=f)delete g.a.g.i[n[k]];
else{g.p&&(g.c.shadowColor="rgba(0,0,0,0)");if(90<f){a=3;g.c.strokeStyle="rgba(255, 255, 0, 1)";g.c.lineWidth=4;g.c.beginPath();c=Math.random()*(110-f);for(e=Math.random()*(140-f);--a;)b=~~(628*Math.random()-314),g.c.moveTo(~~(d.I.x+g.d.m[b]*c),~~(d.I.y+g.d.l[b]*c)),g.c.lineTo(~~(d.I.x+g.d.m[b]*e),~~(d.I.y+g.d.l[b]*e));g.c.stroke();g.c.closePath()}cacheIndex=~~(100*d.e);d.x+=g.d.m[cacheIndex]*0.03*f;d.y+=g.d.l[cacheIndex]*0.03*f;a=(f/100).toFixed(2);g.c.fillStyle=q+","+a+")";i+=~~(i*((100-f)/100));
g.c.fillRect(~~d.x-(i>>1),~~d.y-(i>>1),i,i)}}}}});
